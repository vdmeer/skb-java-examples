<?xml version="1.0" encoding="UTF-8"?>
<project name="publish-common" xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
	<!-- xmlns:maven="antlib:org.apache.maven.artifact.ant" -->

	<import file="common.xml"/>

	<!-- Main targets -->

<!--
	<target name="publish" depends="publish-ivy, publish-maven" description="Publishes all artifacts to remote repositories (common)."/>
-->

	<target name="publish-ivy" depends="ivy.init, resolve" description="Publishes all ivy artifacts to local repository (downloaded) (common)">
		<delete quiet="true" file="${ivy.output.file}"/>
		<mkdir dir="${ivy.output.dir}"/>

 		<ivy:publish resolver="${publication.resolver.prefix}-bundle-publish" pubdate="${timestamp}" status="${release.type}" overwrite="true">
 			<artifacts pattern="${ivy.output.dir}/[artifact].[ext]"/>
<!--
			<artifact name="${ant.project.name}" type="text" ext="pom"/>
			<artifact name="${ant.project.name}" type="text" ext="pom.asc"/>
			<artifact name="${ant.project.name}" type="text" ext="jar.asc"/>
			<artifact name="${ant.project.name}-sources" type="text" ext="jar.asc"/>
			<artifact name="${ant.project.name}-javadoc" type="text" ext="jar.asc"/>
-->
 		</ivy:publish>
	</target>

	<!-- Other targets -->

	<target name="create.pom" depends="ivy.init, resolve">
		<delete quiet="true" file="${pom.output.file}"/>
		<mkdir dir="${pom.output.dir}"/>

		<ivy:makepom ivyfile="${ivy.output.file}" pomfile="${pom.output.file}" templatefile="${env.PROJECT_HOME}/build/pom.template">
			<mapping conf="*" scope="compile"/>
<!--
			<mapping conf="compile" scope="compile"/>
			<mapping conf="provided" scope="provided"/>
			<mapping conf="dm-server-provided" scope="provided"/>
			<mapping conf="runtime" scope="runtime"/>
			<mapping conf="test" scope="test"/>
-->
		</ivy:makepom>
	</target>

	<target name="snapshot.pom" depends="is.snapshot" if="snapshot.release">
		<replaceregexp flags="g" match="(\d(.\d(.\d)?)?).${build.stamp}" replace="\1.BUILD-SNAPSHOT"
			file="${pom.output.file}"/>
	</target>

	<target name="is.snapshot">
		<condition property="snapshot.release">
			<equals arg1="integration" arg2="${release.type}"/>
		</condition>
	</target>

</project>